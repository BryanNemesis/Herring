(this["webpackJsonpherring-web"]=this["webpackJsonpherring-web"]||[]).push([[0],{14:function(e,t,n){"use strict";n.r(t);var i=n(1),c=n.n(i),r=n(7),a=n.n(r),s=n(2),o=n(4);function l(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var c=n[i].trim();if(c.substring(0,e.length+1)===e+"="){t=decodeURIComponent(c.substring(e.length+1));break}}return t}var u=function(e,t,n,i){var c;i&&(c=JSON.stringify(i));var r=new XMLHttpRequest,a="http://localhost:8000/api".concat(t);if(r.responseType="json",r.open(e,a),r.setRequestHeader("Content-Type","application/json"),"POST"===e){var s=l("csrftoken");r.setRequestHeader("X-CSRFToken",s);var o=l("sessionid");r.setRequestHeader("X-SessionID",o),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=!0}r.onload=function(){403===r.status&&"Authentication credentials were not provided."===r.response.detail&&(window.location.href="/login?showLoginRequired=true"),n(r.response,r.status)},r.onerror=function(e){n({message:"Request failed"},400)},r.send(c)};function d(e,t){var n="/fillets";e&&(n+="/?username=".concat(e)),u("GET",n,t)}var f=n(8),b=n(0);var j=function(e){var t=e.fillet,n=e.action,i=e.handlePerformAction,c=e.theme,r=t.like_count?t.like_count:0,a="btn btn-outline-primary btn-sm ".concat(c),s="like"===n.type?"".concat(r," ").concat(n.display):n.display,o=function(e,t){200!==t&&201!==t||!i||i(e,t)};return Object(b.jsx)("button",{className:a,onClick:function(e){e.preventDefault(),function(e,t,n){u("POST","/fillets/action/",n,{id:e,action:t})}(t.id,n.type,o)},children:s})};var p=function e(t){var n=t.fillet,c=t.handleRepost,r=n.text?n.text:"reposted",a=n.is_repost?"px-3 text-muted small":"px-3",o=Object(i.useState)(n||null),l=Object(s.a)(o,2),u=l[0],d=l[1],p=window.location.pathname.match(Object(f.a)(/([0-9]+)/,{filletId:1})),h=p?p.groups.filletId:0,m="".concat(h)==="".concat(n.id),O=function(e,t){200===t?d(e):201===t&&c(e)};return Object(b.jsxs)("div",{className:"col-12 col-md-10 mx-auto border rounded py-2 mb-4",children:[Object(b.jsxs)("div",{children:[Object(b.jsxs)("p",{className:a,children:[Object(b.jsxs)("i",{children:[n.id,":"]})," ",r]}),n.is_repost&&Object(b.jsx)("div",{className:"col-9",children:Object(b.jsx)(e,{fillet:u.parent,handleRepost:c})})]}),u&&Object(b.jsxs)("div",{className:"btn btn-group",children:[Object(b.jsx)(j,{fillet:u,action:{type:"like",display:"Likes"},handlePerformAction:O,theme:"btn-dark"}),Object(b.jsx)(j,{fillet:u,action:{type:"unlike",display:"Unlike"},handlePerformAction:O,theme:"btn-dark"}),Object(b.jsx)(j,{fillet:u,action:{type:"repost",display:"Repost"},handlePerformAction:O,theme:"btn-light"}),!m&&Object(b.jsx)("button",{onClick:function(e){e.preventDefault(),window.location.href="/".concat(n.id)},className:"btn btn-outline-primary btn-sm btn-light",children:"View"})]})]})};var h=function(e){var t=e.newFillets,n=e.setNewFillets,c=e.username,r=Object(i.useState)([]),a=Object(s.a)(r,2),l=a[0],u=a[1],f=Object(i.useState)(t||[]),j=Object(s.a)(f,2),h=j[0],m=j[1],O=Object(i.useState)(!1),v=Object(s.a)(O,2),x=v[0],w=v[1];Object(i.useEffect)((function(){var e=Object(o.a)(t).concat(h);e.length!==l.length&&u(e)}),[l,t,h]),Object(i.useEffect)((function(){if(!x){d(c,(function(e,t){200===t?(m(e),w(!0)):alert("You have error :-D")}))}}),[h,x,c]);var y=function(e){var i=Object(o.a)(t);i.unshift(e),n(i)};return Object(b.jsx)("div",{children:l.map((function(e){return Object(b.jsx)(p,{fillet:e,handleRepost:y},e.id)}))})};var m=function(e){var t=e.newFillets,n=e.setNewFillets,i=c.a.createRef(),r=function(e,i){if(console.log(e,i),201===i){var c=Object(o.a)(t);c.unshift(e),n(c)}else alert("you have error :-D")};return Object(b.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=i.current.value;i.current.value="",u("POST","/fillets/create/",r,{text:t})},children:[Object(b.jsx)("textarea",{className:"form-control",required:!0,ref:i}),Object(b.jsx)("button",{type:"submit",className:"btn btn-outline-primary btn-sm my-3 btn-dark",children:"Post"})]})};function O(e){var t=e.username,n=e.userCanPost,c=Object(i.useState)([]),r=Object(s.a)(c,2),a=r[0],o=r[1];return n="true"===n,Object(b.jsxs)("div",{className:"col-12 mb-3",children:[n&&Object(b.jsx)(m,{newFillets:a,setNewFillets:o}),Object(b.jsx)(h,{newFillets:a,setNewFillets:o,username:t})]})}function v(e){var t=e.filletId,n=Object(i.useState)(!1),c=Object(s.a)(n,2),r=c[0],a=c[1],o=Object(i.useState)(null),l=Object(s.a)(o,2),d=l[0],f=l[1],j=function(e,t){200===t?f(e):alert("Error: could not find fillet.")};return Object(i.useEffect)((function(){!1===r&&(!function(e,t){u("GET","/fillets/".concat(e,"/"),t)}(t,j),a(!0))}),[r,a,t]),null===d?null:Object(b.jsx)(p,{fillet:d,handleRepost:function(){}})}var x=c.a.createElement,w=document.getElementById("herring");w&&a.a.render(x(O,w.dataset),w),document.querySelectorAll(".herring-detail").forEach((function(e){a.a.render(x(v,e.dataset),e)}))}},[[14,1,2]]]);
//# sourceMappingURL=main.8f7cf549.chunk.js.map