(this["webpackJsonpherring-web"]=this["webpackJsonpherring-web"]||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(6),s=n.n(r),l=(n(13),n(2)),i=n(3);function o(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),c=0;c<n.length;c++){var a=n[c].trim();if(a.substring(0,e.length+1)===e+"="){t=decodeURIComponent(a.substring(e.length+1));break}}return t}var u=function(e,t,n,c){var a;c&&(a=JSON.stringify(c));var r=new XMLHttpRequest,s="http://localhost:8000/api".concat(t);r.responseType="json",r.open(e,s),r.setRequestHeader("Content-Type","application/json");var l=o("csrftoken");r.setRequestHeader("X-CSRFToken",l);var i=o("sessionid");r.setRequestHeader("X-SessionID",i),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=!0,r.onload=function(){403===r.status&&"Authentication credentials were not provided."===r.response.detail&&-1===window.location.href.indexOf("login")&&(window.location.href="/login?showLoginRequired=true"),n(r.response,r.status)},r.onerror=function(e){n({message:"Request failed"},400)},r.send(a)};function b(e,t,n){var c="/fillets";e&&(c+="/?username=".concat(e)),n&&(c=n.replace("http://localhost:8000/api","")),u("GET",c,t)}function f(e,t){var n="/fillets/feed";t&&(n=t.replace("http://localhost:8000/api","")),u("GET",n,e)}var j=n(8),d=n(0);var m=function(e){var t=e.fillet,n=e.action,c=e.handlePerformAction,a=e.theme,r=t.like_count?t.like_count:0,s="btn btn-outline-primary btn-sm ".concat(a),l="like"===n.type?"".concat(r," ").concat(n.display):n.display,i=function(e,t){200!==t&&201!==t||!c||c(e,t)};return Object(d.jsx)("button",{className:s,onClick:function(e){e.preventDefault(),function(e,t,n){u("POST","/fillets/action/",n,{id:e,action:t})}(t.id,n.type,i)},children:l})};function O(e){var t=e.username,n=e.children;return Object(d.jsx)("span",{onClick:function(e){e.preventDefault(),window.location.href="/profiles/".concat(t)},className:"pointer",children:n})}function h(e){var t=e.username;return Object(d.jsx)(O,{username:t,children:Object(d.jsxs)("span",{className:"p-1 rounded bg-dark text-white",children:["\xa0",t[0],"\xa0"]})})}function p(e){var t=e.user,n=e.includeFullName,c="".concat(t.first_name," ").concat(t.last_name);return Object(d.jsxs)(d.Fragment,{children:[n&&Object(d.jsxs)(d.Fragment,{children:[c,"\xa0"]}),Object(d.jsxs)(O,{username:t.username,children:["@",Object(d.jsx)("b",{children:t.username})]})]})}var v=function e(t){var n=t.fillet,a=t.handleRepost,r=n.text?n.text:"",s=n.text?" said:":" reposted:",i=Object(c.useState)(n||null),o=Object(l.a)(i,2),u=o[0],b=o[1],f=window.location.pathname.match(Object(j.a)(/([0-9]+)/,{filletId:1})),O=f?f.groups.filletId:0,v="".concat(O)==="".concat(n.id),x=function(e,t){200===t?b(e):201===t&&a(e)};return Object(d.jsxs)("div",{className:"col-12 col-md-10 mx-auto border rounded py-2 mb-2",children:[Object(d.jsxs)("div",{className:"p-3 text-muted small",children:[Object(d.jsx)(h,{username:n.user.username}),"\xa0",Object(d.jsx)(p,{user:n.user,includeFullName:!0}),s]}),Object(d.jsx)("p",{className:"px-4",children:Object(d.jsx)("b",{children:r})}),n.is_repost&&Object(d.jsx)("div",{className:"col-9",children:Object(d.jsx)(e,{fillet:u.parent,handleRepost:a})}),u&&Object(d.jsxs)("div",{className:"btn btn-group",children:[Object(d.jsx)(m,{fillet:u,action:{type:"like",display:"Likes"},handlePerformAction:x,theme:"btn-dark"}),Object(d.jsx)(m,{fillet:u,action:{type:"unlike",display:"Unlike"},handlePerformAction:x,theme:"btn-dark"}),Object(d.jsx)(m,{fillet:u,action:{type:"repost",display:"Repost"},handlePerformAction:x,theme:"btn-light"}),!v&&Object(d.jsx)("button",{onClick:function(e){e.preventDefault(),window.location.href="/".concat(n.id)},className:"btn btn-outline-primary btn-sm btn-light",children:"View"})]})]})};var x=function(e){var t=e.newFillets,n=e.setNewFillets,a=e.username,r=Object(c.useState)([]),s=Object(l.a)(r,2),o=s[0],u=s[1],f=Object(c.useState)(t||[]),j=Object(l.a)(f,2),m=j[0],O=j[1],h=Object(c.useState)(!1),p=Object(l.a)(h,2),x=p[0],w=p[1],g=Object(c.useState)(null),k=Object(l.a)(g,2),y=k[0],N=k[1];Object(c.useEffect)((function(){var e=Object(i.a)(t).concat(m);e.length!==o.length&&u(e)}),[o,t,m]),Object(c.useEffect)((function(){if(!x){b(a,(function(e,t){200===t?(N(e.next),O(e.results),w(!0)):alert("You have error :-D")}))}}),[m,x,a]);var F=function(e){var c=Object(i.a)(t);c.unshift(e),n(c)};return Object(d.jsxs)(d.Fragment,{children:[o.map((function(e){return Object(d.jsx)(v,{fillet:e,handleRepost:F},e.id)})),null!==y&&Object(d.jsx)("button",{onClick:function(e){if(e.preventDefault(),null!==y){b(a,(function(e,t){if(200===t){N(e.next);var n=Object(i.a)(o).concat(e.results);u(n),O(n)}else alert("You have error :-D")}),y)}},className:"btn btn-outline-primary btn-sm btn-dark",children:"More"})]})};var w=function(e){var t=e.newFillets,n=e.setNewFillets,a=e.username,r=Object(c.useState)([]),s=Object(l.a)(r,2),o=s[0],u=s[1],b=Object(c.useState)(t||[]),j=Object(l.a)(b,2),m=j[0],O=j[1],h=Object(c.useState)(!1),p=Object(l.a)(h,2),x=p[0],w=p[1],g=Object(c.useState)(null),k=Object(l.a)(g,2),y=k[0],N=k[1];Object(c.useEffect)((function(){var e=Object(i.a)(t).concat(m);e.length!==o.length&&u(e)}),[o,t,m]),Object(c.useEffect)((function(){if(!x){f((function(e,t){200===t&&(N(e.next),O(e.results),w(!0))}))}}),[m,x,a]);var F=function(e){var c=Object(i.a)(t);c.unshift(e),n(c)};return Object(d.jsxs)(d.Fragment,{children:[o.map((function(e){return Object(d.jsx)(v,{fillet:e,handleRepost:F},e.id)})),null!==y&&Object(d.jsx)("button",{onClick:function(e){if(e.preventDefault(),null!==y){f((function(e,t){if(200===t){N(e.next);var n=Object(i.a)(o).concat(e.results);u(n),O(n)}else alert("You have error :-D")}),y)}},className:"btn btn-outline-primary btn-sm btn-dark",children:"More"})]})};var g=function(e){var t=e.newFillets,n=e.setNewFillets,c=a.a.createRef(),r=function(e,c){if(console.log(e,c),201===c){var a=Object(i.a)(t);a.unshift(e),n(a)}else alert("you have error :-D")};return Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=c.current.value;c.current.value="",u("POST","/fillets/create/",r,{text:t})},children:[Object(d.jsx)("textarea",{className:"form-control",required:!0,ref:c}),Object(d.jsx)("button",{type:"submit",className:"btn btn-outline-primary btn-sm my-3 btn-dark",children:"Post"})]})};function k(e){var t=e.username,n=e.userCanPost,a=Object(c.useState)([]),r=Object(l.a)(a,2),s=r[0],i=r[1];return n="true"===n,Object(d.jsxs)("div",{className:"col-12 mb-3",children:[n&&Object(d.jsx)(g,{newFillets:s,setNewFillets:i}),Object(d.jsx)(x,{newFillets:s,setNewFillets:i,username:t})]})}function y(e){var t=e.filletId,n=Object(c.useState)(!1),a=Object(l.a)(n,2),r=a[0],s=a[1],i=Object(c.useState)(null),o=Object(l.a)(i,2),b=o[0],f=o[1],j=function(e,t){200===t?f(e):alert("Error: could not find fillet.")};return Object(c.useEffect)((function(){!1===r&&(!function(e,t){u("GET","/fillets/".concat(e,"/"),t)}(t,j),s(!0))}),[r,s,t]),null===b?null:Object(d.jsx)(v,{fillet:b,handleRepost:function(){}})}var N=a.a.createElement,F=document.getElementById("herring");F&&s.a.render(N(k,F.dataset),F);var S=document.getElementById("herring-feed");S&&s.a.render(N((function(e){var t=e.username,n=e.userCanPost,a=Object(c.useState)([]),r=Object(l.a)(a,2),s=r[0],i=r[1];return n="true"===n,Object(d.jsxs)("div",{className:"col-12 mb-3",children:[n&&Object(d.jsx)(g,{newFillets:s,setNewFillets:i}),Object(d.jsx)(w,{newFillets:s,setNewFillets:i,username:t})]})}),S.dataset),S),document.querySelectorAll(".herring-detail").forEach((function(e){s.a.render(N(y,e.dataset),e)}))}},[[15,1,2]]]);
//# sourceMappingURL=main.cb226e24.chunk.js.map